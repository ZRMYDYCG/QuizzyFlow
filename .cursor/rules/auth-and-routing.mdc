---
description: 认证系统和路由权限配置
globs: src/router/**,src/hooks/useNavPage.ts,src/pages/Login/**,src/pages/Register/**
---

# 认证系统和路由权限

## 路由结构

路由配置位于 [router/index.tsx](mdc:src/router/index.tsx)

### 公共路由 (HomeLayout)
无需登录即可访问：
- `/` - 首页
- `/login` - 登录页
- `/register` - 注册页
- `/forgot-password` - 忘记密码
- `/terms` - 服务条款
- `/privacy` - 隐私政策

### 管理路由 (ManageLayout)
需要登录：
- `/manage/list` - 问卷列表
- `/manage/star` - 星标问卷
- `/manage/trash` - 回收站

### 问卷路由 (QuestionLayout)
需要登录：
- `/question/edit/:id` - 编辑问卷
- `/question/statistics/:id` - 数据统计
- `/question/publish/:id` - 发布问卷

## 权限控制

### useNavPage Hook ([useNavPage.ts](mdc:src/hooks/useNavPage.ts))

自动处理路由权限：

```typescript
const isNoAuthPath = [
  '/', 
  '/login', 
  '/register', 
  '/forgot-password',  // 公共页面
  '/terms',            // 公共页面
  '/privacy'           // 公共页面
]
```

**逻辑规则**:
1. 未登录用户访问受保护页面 → 重定向到 `/login`
2. 已登录用户访问 `/login` 或 `/register` → 重定向到 `/manage/list`
3. 公共页面无论登录状态都可访问

## 登录/注册页面设计

### 布局结构
- **左侧 (45%)**: 深色背景 (#0f1419) + 表单
- **右侧 (55%)**: 高清背景图 + 内容卡片
- **响应式**: 移动端只显示表单区域

### 登录页面 ([Login/index.tsx](mdc:src/pages/Login/index.tsx))

**功能**:
- 邮箱 + 密码登录
- Google 账号登录（预留）
- 记住我
- 忘记密码链接
- 用户评价轮播（每5秒切换）

**评价数据**:
```typescript
const testimonials = [
  { text: '...', author: '一勺', role: '市场调研经理' },
  { text: '...', author: 'Janike', role: '产品经理' },
  { text: '...', author: 'Smith', role: 'HR主管' },
  { text: '...', author: 'JustHappy', role: '用户研究员' },
]
```

### 注册页面 ([Register/index.tsx](mdc:src/pages/Register/index.tsx))

**字段**:
- 邮箱 (username) - 必填，邮箱格式验证
- 昵称 (nickname) - 必填，2-20字符
- 密码 (password) - 必填，最少6字符
- 确认密码 - 必填，需匹配

**右侧内容**: 产品特性展示
- 拖拽式问卷编辑
- 智能数据分析
- 多端分享发布

## API 接口

```typescript
// src/api/modules/user.ts

// 登录
loginUser(params: { username: string, password: string })
// POST /api/auth/login

// 注册
registerUser(params: { 
  username: string, 
  password: string, 
  nickname: string 
})
// POST /api/user/register

// 获取用户信息
getUserInfo()
// GET /api/auth/profile
```

## Token 管理

- Token 存储在 `localStorage` 中
- Key: `'token'`
- 在 axios 拦截器中自动添加到请求头
- 登录成功后自动跳转到 `/manage/list`

## 添加新的公共页面

1. 在 `src/pages/` 创建页面组件
2. 在 `src/router/index.tsx` 添加路由
3. 在 `src/hooks/useNavPage.ts` 的 `isNoAuthPath` 数组中添加路径
4. 确保页面使用 HomeLayout 布局
